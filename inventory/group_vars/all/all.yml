# Non-secret shared defaults. Secrets live in inventory/group_vars/all/vault.yml.

# Database discovery for app + Keycloak.
releasy_db_primary_host: "{{ groups.get('releasy_db', []) | first | default('', true) }}"
postgres_host_auto: >-
  {{
    (
      hostvars[releasy_db_primary_host].tailscale_dns_name
      | default(
        hostvars[releasy_db_primary_host].tailscale_hostname,
        true
      )
    )
    if (releasy_db_primary_host and (hostvars[releasy_db_primary_host].tailscale_enabled | default(false)))
    else (
      hostvars[releasy_db_primary_host].ansible_host
      | default(releasy_db_primary_host)
    )
  }}
postgres_host: "{{ postgres_host_auto }}"
postgres_port: 5432
postgres_app_db: "releasy"
postgres_app_user: "releasy"
